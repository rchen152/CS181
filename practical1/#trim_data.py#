import numpy as np
import hacked_util as util

# This makes predictions based on the mean rating for each book in the
# training data.  When there are no training data for a book, it
# defaults to the global mean.

pred_filename  = 'trim-output.csv'
train_filename = 'predictor-kmeans1.csv'

training_data  = util.load_test(train_filename)
test_queries   = util.load_test(test_filename)
book_list      = util.load_books(book_filename)


# Make predictions for each test query.
for query in test_queries:
    query['rating'] = training_data[query['id']
    book = books[query['isbn']]

    if book['count'] == 0:
        # Perhaps we did not having any ratings in the training set.
        # In this case, make a global mean prediction.
        query['rating'] = mean_rating

    else:
        # Predict the average for this book.
        query['rating'] = float(book['total']) / book['count']

# Write the prediction file.
util.write_predictions(test_queries, pred_filename)
